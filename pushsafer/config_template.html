<script type="text/x-red" data-template-name="pushsafer_config_template">
  <div class="form-row">
      <label for="node-config-input-title"><i class="fa fa-header"></i> Title</label>
      <input type="text" id="node-config-input-title">
  </div>
  <div class="form-row">
      <label for="node-config-input-message"><i class="fa fa-envelope-o"></i> Message</label>
      <input type="text" id="node-config-input-message">
  </div>
  <div class="form-row">
      <label for="node-config-input-sound"><i class="fa fa-volume-up"></i> Sound</label>
      <select id="node-config-input-sound" style="width:70%">
          <option value></option>
          <option value="0">Silent</option>
          <option value="1">Ahem (IM)</option>
          <option value="2">Applause (Mail)</option>
          <option value="3">Arrow (Reminder)</option>
          <option value="4">Baby (SMS)</option>
          <option value="5">Bell (Alarm)</option>
          <option value="6">Bicycle (Alarm2)</option>
          <option value="7">Boing (Alarm3)</option>
          <option value="8">Buzzer (Alarm4)</option>
          <option value="9">Camera (Alarm5)</option>
          <option value="10">Car Horn (Alarm6)</option>
          <option value="11">Cash Register (Alarm7)</option>
          <option value="12">Chime (Alarm8)</option>
          <option value="13">Creaky Door (Alarm9)</option>
          <option value="14">Cuckoo Clock (Alarm10)</option>
          <option value="15">Disconnect (Call)</option>
          <option value="16">Dog (Call2)</option>
          <option value="17">Doorbell (Call3)</option>
          <option value="18">Fanfare (Call4)</option>
          <option value="19">Gun Shot (Call5)</option>
          <option value="20">Honk (Call6)</option>
          <option value="21">Jaw Harp (Call7)</option>
          <option value="22">Morse (Call8)</option>
          <option value="23">Electricity (Call9)</option>
          <option value="24">Radio Tuner (Call10)</option>
          <option value="25">Sirens</option>
          <option value="26">Military Trumpets</option>
          <option value="27">Ufo</option>
          <option value="28">Whah Whah Whah</option>
          <option value="29">Man Saying Goodbye</option>
          <option value="30">Man Saying Hello</option>
          <option value="31">Man Saying No</option>
          <option value="32">Man Saying Ok</option>
          <option value="33">Man Saying Ooohhhweee</option>
          <option value="34">Man Saying Warning</option>
          <option value="35">Man Saying Welcome</option>
          <option value="36">Man Saying Yeah</option>
          <option value="37">Man Saying Yes</option>
          <option value="38">Beep short</option>
          <option value="39">Weeeee short</option>
          <option value="40">Cut in and out short</option>
          <option value="41">Finger flicking glas short</option>
          <option value="42">Wa Wa Waaaa short</option>
          <option value="43">Laser short</option>
          <option value="44">Wind Chime short</option>
          <option value="45">Echo short</option>
          <option value="46">Zipper short</option>
          <option value="47">HiHat short</option>
          <option value="48">Beep 2 short</option>
          <option value="49">Beep 3 short</option>
          <option value="50">Beep 4 short</option>
          <option value="51">The Alarm is armed</option>
          <option value="52">The Alarm is disarmed</option>
          <option value="53">The Backup is ready</option>
          <option value="54">The Door is closed</option>
          <option value="55">The Door is opend</option>
          <option value="56">The Window is closed</option>
          <option value="57">The Window is open</option>
          <option value="58">The Light is off</option>
          <option value="59">The Light is on</option>
          <option value="60">The Doorbell rings</option>
          <option value="61">Pager short</option>
          <option value="62">Pager long</option>
      </select>
  </div>
  <div class="form-row">
      <label for="node-config-input-vibration"><i class="fa fa-bell"></i> Vibration</label>
      <select id="node-config-input-vibration" style="width:70%">
          <option value></option>
          <option value="1">1x</option>
          <option value="2">2x</option>
          <option value="3">3x</option>
      </select>
  </div>
  <div class="form-row">
      <label for="node-config-input-icon"><i class="fa fa-file-image-o"></i> Icon</label>
      <input type="number" min="1" max="177" id="node-config-input-icon">
  </div>
  <div class="form-row">
      <label for="node-config-input-iconcolor"><i class="fa fa-paint-brush"></i> Icon color</label>
      <input type="color" value="#FFFFFF" id="node-config-input-iconcolor" class="series-color">
  </div>
  <div class="form-row">
      <label for="node-config-input-url"><i class="fa fa-external-link"></i> URL</label>
      <input type="url" id="node-config-input-url">
  </div>
  <div class="form-row">
      <label for="node-config-input-urltitle"><i class="fa fa-external-link"></i> URL Title</label>
      <input type="text" id="node-config-input-urltitle">
  </div>
  <div class="form-row">
      <label for="node-config-input-image"><i class="fa fa-picture-o"></i> Image</label>
      <input type="text" id="node-config-input-image">
  </div>
  <div class="form-row">
      <label for="node-config-input-image-use-payload">&nbsp;</label>
      <input type="checkbox" id="node-config-input-imageusepayload" style="display:inline-block; width:15px; vertical-align:baseline;" autocomplete="off">
      <span>Use msg.payload as image</span>
  </div>
  <div class="form-row">
      <label for="node-config-input-image2"><i class="fa fa-picture-o"></i> Image 2</label>
      <input type="text" id="node-config-input-image2">
  </div>
  <div class="form-row">
      <label for="node-config-input-image2-use-payload">&nbsp;</label>
      <input type="checkbox" id="node-config-input-image2usepayload" style="display:inline-block; width:15px; vertical-align:baseline;" autocomplete="off">
      <span>Use msg.payload as image 2</span>
  </div>
  <div class="form-row">
      <label for="node-config-input-image3"><i class="fa fa-picture-o"></i> Image 3</label>
      <input type="text" id="node-config-input-image3">
  </div>
  <div class="form-row">
      <label for="node-config-input-image3-use-payload">&nbsp;</label>
      <input type="checkbox" id="node-config-input-image3usepayload" style="display:inline-block; width:15px; vertical-align:baseline;" autocomplete="off">
      <span>Use msg.payload as image 3</span>
  </div>
  <div class="form-row">
      <label for="node-config-input-imagesize"><i class="fa fa-picture-o"></i> Image Size</label>
      <select id="node-config-input-imagesize" style="width:70%">
          <option value></option>
          <option value="0">1024px</option>
          <option value="1">768px</option>
          <option value="2">512px</option>
          <option value="3">256px</option>
      </select>
  </div>
  <div class="form-row">
      <label for="node-config-input-timetolive"><i class="fa fa-heart-o"></i> Time to live</label>
      <input type="number" min="0" max="43200" step="1" id="node-config-input-timetolive">
  </div>
  <div class="form-row">
      <label for="node-config-input-priority"><i class="fa fa-exclamation"></i> Priority</label>
      <select id="node-config-input-priority" style="width:70%">
          <option value></option>
          <option value="-2">lowest</option>
          <option value="-1">low</option>
          <option value="0">normal</option>
          <option value="1">high</option>
          <option value="2">highest</option>
      </select>
  </div>
  <div class="form-row">
      <label for="node-config-input-retry"><i class="fa fa-repeat"></i> Retry</label>
      <input type="number" min="60" max="10800" step="60" id="node-config-input-retry">
  </div>
  <div class="form-row">
      <label for="node-config-input-expire"><i class="fa fa-heart"></i> Expire</label>
      <input type="number" min="60" max="10800" step="60" id="node-config-input-expire">
  </div>
  <div class="form-row">
      <label for="node-config-input-answer"><i class="fa fa-commenting-o"></i> Answer</label>
      <select id="node-config-input-answer" style="width:70%">
          <option value></option>
          <option value="0">not allowed</option>
          <option value="1">allowed</option>
      </select>
  </div>
  <div class="form-row">
      <label for="node-config-input-confirm"><i class="fa fa-picture-o"></i> Confirm / Resend</label>
      <input type="number" min="10" max="10800" step="10" id="node-config-input-confirm">
  </div>
  <div class="form-row">
      <label for="node-config-input-giphy"><i class="fa fa-picture-o"></i> GIPHY GIF</label>
      <input type="text" id="node-config-input-giphy">
  </div>
  <br/>
  <div class="form-row">
      <label for="node-config-input-name"><i class="fa fa-tag"></i> Name</label>
      <input type="text" id="node-config-input-name" data-i18n="[placeholder]pushsafer.config_template.namePlaceholder">
  </div>
</script>

<script type="text/javascript">
  RED.nodes.registerType('pushsafer_config_template', {
    category: 'config',
    defaults: {
      name: { value: '' },
      title: {
        value: null,
        required: false,
        validate: (v) => {
          return String(v).length <= 255;
        },
      },
      message: {
        value: null,
        required: false,
        validate: (v) => {
          return String(v).length <= 5000;
        },
      },
      sound: {
        value: null,
        required: false,
        validate: (v) => {
          return (v >= 0 && v <= 62) || v === '';
        },
      },
      vibration: {
        value: null,
        required: false,
        validate: (v) => {
          return (v >= 1 && v <= 3) || v === '';
        },
      },
      icon: {
        value: null,
        required: false,
        validate: (v) => {
          return (v >= 1 && v <= 177) || v === '';
        },
      },
      iconcolor: {
        value: null,
        required: false,
        validate: (v) => {
          return /^#[0-9A-F]{6}$/i.test(v);
        },
      },
      url: { value: null, required: false },
      urltitle: { value: null, required: false },
      image: { value: null, required: false },
      imageusepayload: { value: null, required: false },
      image2: { value: null, required: false },
      image2usepayload: { value: null, required: false },
      image3: { value: null, required: false },
      image3usepayload: { value: null, required: false },
      imagesize: {
        value: null,
        required: false,
        validate: (v) => {
          return (v >= 0 && v <= 3) || v === '';
        },
      },
      timetolive: {
        value: null,
        required: false,
        validate: (v) => {
          return (v >= 0 && v <= 43200) || v === '';
        },
      },
      priority: {
        value: null,
        required: false,
        validate: (v) => {
          return (v >= -2 && v <= 2) || v === '';
        },
      },

      retry: {
        value: null,
        required: false,
        validate: (v) => {
          return (v >= 60 && v <= 10800) || v === '';
        },
      },
      expire: {
        value: null,
        required: false,
        validate: (v) => {
          return (v >= 60 && v <= 10800) || v === '';
        },
      },
      answer: {
        value: null,
        required: false,
        validate: (v) => {
          return (v >= 0 && v <= 1) || v === '';
        },
      },
      confirm: {
        value: null,
        required: false,
        validate: (v) => {
          return (v >= 10 && v <= 10800) || v === '';
        },
      },
      giphy: {
        value: null,
        required: false,
        validate: (v) => {
          return String(v).length <= 255;
        },
      },
    },
    label: function () {
      return this.name || this._('pushsafer.config_template.newInstance');
    },
    oneditprepare: function () {
      window['pushsaferUpdateIconNumber'] = (iconNumber) => {
        $('#node-config-input-icon').val(iconNumber);
        $('#pushsafer-config-template-help-icon').hide();
      };
      setTimeout(() => {
        for (let i = 1; i <= 60; i++) {
          $('#pushsafer-icon-list-left').append(`<li><img src="https://www.pushsafer.com/assets/icons/${i}.jpg" width="32" height="32" style="cursor:pointer" onclick="pushsaferUpdateIconNumber(${i})"></li>`);
          $('#pushsafer-icon-list-middle').append(`<li><img src="https://www.pushsafer.com/assets/icons/${i + 60}.jpg" width="32" height="32" style="cursor:pointer" onclick="pushsaferUpdateIconNumber(${i + 60})"></li>`);
          if (i + 120 <= 177) $('#pushsafer-icon-list-right').append(`<li><img src="https://www.pushsafer.com/assets/icons/${i + 120}.jpg" width="32" height="32" style="cursor:pointer" onclick="pushsaferUpdateIconNumber(${i + 120})"></li>`);
        }
                
        $('#node-config-input-title').hover(
          () => $('#pushsafer-config-template-help-title').show(),
          () => $('#pushsafer-config-template-help-title').hide()
        );
        $('#node-config-input-message').hover(
          () => $('#pushsafer-config-template-help-message').show(),
          () => $('#pushsafer-config-template-help-message').hide()
        );
        $('#node-config-input-sound').hover(
          () => $('#pushsafer-config-template-help-sound').show(),
          () => $('#pushsafer-config-template-help-sound').hide()
        );
        $('#node-config-input-vibration').hover(
          () => $('#pushsafer-config-template-help-vibration').show(),
          () => $('#pushsafer-config-template-help-vibration').hide()
        );
        $('#node-config-input-icon').focusin(() => $('#pushsafer-config-template-help-icon').show());
        $('#node-config-input-icon').focusout(() => setTimeout(() => $('#pushsafer-config-template-help-icon').hide(), 250));
        $('#node-config-input-iconcolor').hover(
          () => $('#pushsafer-config-template-help-iconcolor').show(),
          () => $('#pushsafer-config-template-help-iconcolor').hide()
        );
        $('#node-config-input-url').hover(
          () => $('#pushsafer-config-template-help-url').show(),
          () => $('#pushsafer-config-template-help-url').hide()
        );
        $('#node-config-input-urltitle').hover(
          () => $('#pushsafer-config-template-help-urltitle').show(),
          () => $('#pushsafer-config-template-help-urltitle').hide()
        );
        $('#node-config-input-image').hover(
          () => $('#pushsafer-config-template-help-image').show(),
          () => $('#pushsafer-config-template-help-image').hide()
        );
        $('#node-config-input-imageusepayload').hover(
          () => $('#pushsafer-config-template-help-imageusepayload').show(),
          () => $('#pushsafer-config-template-help-imageusepayload').hide()
        );
        $('#node-config-input-image2').hover(
          () => $('#pushsafer-config-template-help-image2').show(),
          () => $('#pushsafer-config-template-help-image2').hide()
        );
        $('#node-config-input-image2usepayload').hover(
          () => $('#pushsafer-config-template-help-image2usepayload').show(),
          () => $('#pushsafer-config-template-help-image2usepayload').hide()
        );
        $('#node-config-input-image3').hover(
          () => $('#pushsafer-config-template-help-image3').show(),
          () => $('#pushsafer-config-template-help-image3').hide()
        );
        $('#node-config-input-image3usepayload').hover(
          () => $('#pushsafer-config-template-help-image3usepayload').show(),
          () => $('#pushsafer-config-template-help-image3usepayload').hide()
        );
        $('#node-config-input-imagesize').hover(
          () => $('#pushsafer-config-template-help-imagesize').show(),
          () => $('#pushsafer-config-template-help-imagesize').hide()
        );
        $('#node-config-input-timetolive').hover(
          () => $('#pushsafer-config-template-help-timetolive').show(),
          () => $('#pushsafer-config-template-help-timetolive').hide()
        );
        $('#node-config-input-priority').hover(
          () => $('#pushsafer-config-template-help-priority').show(),
          () => $('#pushsafer-config-template-help-priority').hide()
        );
        $('#node-config-input-retry').hover(
          () => $('#pushsafer-config-template-help-retry').show(),
          () => $('#pushsafer-config-template-help-retry').hide()
        );
        $('#node-config-input-expire').hover(
          () => $('#pushsafer-config-template-help-expire').show(),
          () => $('#pushsafer-config-template-help-expire').hide()
        );
        $('#node-config-input-answer').hover(
          () => $('#pushsafer-config-template-help-answer').show(),
          () => $('#pushsafer-config-template-help-answer').hide()
        );
        $('#node-config-input-confirm').hover(
          () => $('#pushsafer-config-template-help-confirm').show(),
          () => $('#pushsafer-config-template-help-confirm').hide()
        );
        $('#node-config-input-giphy').hover(
          () => $('#pushsafer-config-template-help-giphy').show(),
          () => $('#pushsafer-config-template-help-giphy').hide()
        );

        $('#node-config-input-imageusepayload').change(function (e) {
          if ($(this).prop('checked')) {
            $('#node-config-input-image').val(null);
            $('#node-config-input-image').prop('disabled', true);
          } else {
            $('#node-config-input-image').prop('disabled', false);
          }
        });
        $('#node-config-input-imageusepayload').change();

        $('#node-config-input-image2usepayload').change(function (e) {
          if ($(this).prop('checked')) {
            $('#node-config-input-image2').val(null);
            $('#node-config-input-image2').prop('disabled', true);
          } else {
            $('#node-config-input-image2').prop('disabled', false);
          }
        });
        $('#node-config-input-image2usepayload').change();

        $('#node-config-input-image3usepayload').change(function (e) {
          if ($(this).prop('checked')) {
            $('#node-config-input-image3').val(null);
            $('#node-config-input-image3').prop('disabled', true);
          } else {
            $('#node-config-input-image3').prop('disabled', false);
          }
        });
        $('#node-config-input-image3usepayload').change();
      }, 250);
    },
    oneditsave: function () {
      delete window['pushsaferUpdateIconNumber'];
    },
    oneditcancel: function () {
      delete window['pushsaferUpdateIconNumber'];
    },
  });
</script>
